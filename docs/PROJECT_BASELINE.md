# ПАСПОРТ БАЗОВОЙ ВЕРСИИ ПРОЕКТА

## Основные сведения
*   **Дата создания:** 4 февраля 2026 года
*   **Статус:** Рабочий прототип. Сборка успешна для обеих плат.
*   **Описание:** Система умного дома на ESP-NOW. Центральный хаб (ESP32) с веб-интерфейсом управляет удалённым узлом (ESP32-C3), включая/выключая его светодиод.

## Среда разработки и цели сборки
*   **PlatformIO Core:** `espressif32`
*   **Framework:** `arduino`
*   **Хаб (ESP32):** Плата `esp32dev`, окружение `esp32-wroom-32u`
*   **Узел (ESP32-C3):** Плата `esp32-c3-devkitm-1`, окружение `esp32c3`

## Версии библиотек (ВАЖНО! ЗАФИКСИРОВАТЬ)
Эти версии гарантируют стабильную сборку проекта. При обновлении библиотек проверяйте совместимость.

### Проект "Хаб" (`firmware/hub_esp32`)
*   `bblanchon/ArduinoJson @ 6.21.3`
*   `me-no-dev/ESPAsyncWebServer @ 3.6.0`
*   **Примечание:** Библиотека `AsyncTCP` не указана явно, но является обязательной зависимостью для `ESPAsyncWebServer`. PlatformIO установит её автоматически совместимую версию.

### Проект "Узел" (`firmware/node_esp32c3`)
*   Использует ядро ESP32: `https://github.com/espressif/arduino-esp32.git`
*   Игнорируется библиотека: `ArduinoOTA`

## Конфигурация устройств
*   **SSID точки доступа хаба:** `ESP32-Hub-Test`
*   **Пароль:** `test12345678`
*   **MAC-адрес узла (зашит в коде хаба):** `AC:EB:E6:49:10:28`
*   **MAC-адрес хаба (для замены в коде узла):** Узнать из Serial Monitor после прошивки хаба.
*   **Пин светодиода на узле:** `GPIO8` (активный LOW на ESP32-C3 DevKit)
*   **Скорость монитора узла:** `115200` бод

## Инструкция первого запуска
1.  **Собрать и прошить хаб:** Откройте проект `firmware/hub_esp32` в PlatformIO -> Build -> Upload.
2.  **Узнать MAC хаба:** Откройте Serial Monitor (115200). Где-то в логе (или добавьте `Serial.println(WiFi.softAPmacAddress());` в `setup()`) будет выведен реальный MAC-адрес в формате `XX:XX:XX:XX:XX:XX`.
3.  **Исправить адрес в коде узла:** В файле `firmware/node_esp32c3/src/main.cpp` найдите строку с `hubMacAddress` и замените массив на реальный MAC хаба. Например, `{0x9C, 0x9C, 0x1F, 0xC7, 0x2D, 0x94}`.
4.  **Собрать и прошить узел:** Откройте проект `firmware/node_esp32c3` -> Build -> Upload.
5.  **Подключиться к системе:** На клиенте (телефон/ПК) подключитесь к Wi-Fi сети `ESP32-Hub-Test`. В браузере откройте IP-адрес, который вывел хаб в Serial Monitor (обычно `192.168.4.1`).
6.  **Проверить работу:** Используйте кнопки на веб-странице для управления светодиодом на узле.

## Известные особенности и возможные проблемы
1.  Хаб для работы ESP-NOW использует режим `WiFi.mode(WIFI_AP_STA)` (точка доступа + клиент).
2.  Структура данных `esp_now_message` должна быть в точности одинаковой в коде хаба и узла.
3.  В коде используется актуальный API ESP-NOW для Arduino Core версии 3.4.0+.
4.  **Важно!** В конфигурации хаба отсутствует библиотека `AsyncTCP` в `lib_deps`. PlatformIO установит её сам, но для полной воспроизводимости рекомендуется добавить строку `ESP32 Async TCP @ 1.2.2` в раздел `lib_deps` файла `hub_platformio.ini`.
5.  Библиотека `ArduinoOTA` на узле отключена через `lib_ignore`, что может быть важно для экономии памяти.